var graph={rawData:[],alertsCrossFilter:{},config:{},selectedFilters:{},dateFilterRange:null,dimensions:{},ctlFirstLoading:!1,totalizedDeforestationArea:null,totalizedDegradationArea:null,totalizedAlertsInfoBox:null,totalizedCustomArea:null,lineDistributionByMonth:void 0,ringTotalizedByClass:void 0,histTopByCounties:void 0,ringTotalizedByState:void 0,histTopByUCs:void 0,deforestation:["DESMATAMENTO_CR","DESMATAMENTO_VEG","MINERACAO"],degradation:["CICATRIZ_DE_QUEIMADA","CORTE_SELETIVO","CS_DESORDENADO","CS_GEOMETRICO","DEGRADACAO"],histogramColor:["#0000FF","#57B4F0"],pallet:["#FF0000","#FF6A00","#FF8C00","#FFA500","#FFD700","#FFFF00","#DA70D6","#BA55D3","#7B68EE"],barTop10Color:"#b8b8b8",setConfigurations:function(conf){conf?(graph.pallet=conf.pallet?conf.pallet:graph.pallet,graph.histogramColor=conf.histogramColor?conf.histogramColor:graph.histogramColor,graph.barTop10Color=conf.barTop10Color?conf.barTop10Color:graph.barTop10Color,graph.defaultHeight=conf.defaultHeight?conf.defaultHeight:utils.getDefaultHeight()):console.log("Didn't load config file. Using default options.")},init:function(config,data){0!=data.length&&void 0===data.exception?(Lang.apply(),graph.setConfigurations(config.dataConfig),this.loadData(!1,data)&&(this.displayWaiting(!1),this.config=config,this.totalizedDeforestationArea=dc.numberDisplay("#deforestation-classes"),this.totalizedDegradationArea=dc.numberDisplay("#degradation-classes"),this.totalizedAlertsInfoBox=dc.numberDisplay("#numpolygons"),this.totalizedCustomArea=d3.select("#custom-classes"),this.lineDistributionByMonth=dc.barChart("#chart-line-by-month"),this.ringTotalizedByClass=dc.pieChart("#chart-ring-by-class"),this.histTopByCounties=dc.rowChart("#chart-hist-top-counties"),this.ringTotalizedByState=dc.pieChart("#chart-ring-by-state"),this.histTopByUCs=dc.rowChart("#chart-hist-top-ucs"),graph.build(),graph.filterByClassGroup("deforestation"),SearchEngine.init(this.histTopByCounties,this.ringTotalizedByState,"modal-search"))):this.displayWarning(!0)},startLoadData:function(){var afterLoadConfiguration=function(cfg){utils.displayLoginExpiredMessage(),graph.displayWaiting();var configDashboard={defaultDataDimension:"area",resizeTimeout:0,minWidth:250,dataConfig:cfg},dataUrl=downloadCtrl.getFileDeliveryURL()+"/download/"+downloadCtrl.getProject()+"/all_daily";downloadCtrl.isLocalhost()&&(dataUrl="./data/deter-amazon-daily.json");var afterLoadData=function(json){Lang.apply(),json&&json.features?(graph.setUpdatedDate(json.updated_date),graph.init(configDashboard,json.features)):graph.displayWarning(!0)};d3.json(dataUrl).header("Authorization","Bearer "+("undefined"!=typeof Authentication?Authentication.getToken():"")).get((function(error,body){error&&401==error.status?"undefined"!=typeof Authentication&&(Authentication.logout(),Authentication.setExpiredToken(!0)):afterLoadData(body)}))};d3.json("./config/deter-amazon-daily.json",afterLoadConfiguration)},setUpdatedDate:function(updated_date){if(void 0!==updated_date)d3.select("#updated_date").html(" "+new Date(updated_date+"T21:00:00.000Z").toLocaleDateString(Lang.language));else{let layer_name="undefined"!=typeof Authentication&&Authentication.hasToken()?"last_date":"updated_date",url=downloadCtrl.getTerraBrasilisHref()+"/geoserver/"+downloadCtrl.getProject()+"/wfs?SERVICE=WFS&REQUEST=GetFeature&VERSION=2.0.0&TYPENAME="+layer_name+"&OUTPUTFORMAT=application%2Fjson";d3.json(url,(function(jsonResponse){let dt=jsonResponse&&jsonResponse.features[0].properties?new Date(jsonResponse.features[0].properties.updated_date+"T21:00:00.000Z").toLocaleDateString(Lang.language):"?";d3.select("#updated_date").html(" "+dt)}))}},displayWaitingChanges:function(enable){void 0===enable&&(enable=!0),d3.select("#loading_data_info").style("display",enable?"":"none"),d3.select("#info_container").style("display",enable?"":"none")},displayWaiting:function(enable){void 0===enable&&(enable=!0),d3.select("#charts-panel").style("display",enable?"none":""),d3.select("#loading_data_info").style("display",enable?"":"none"),d3.select("#info_container").style("display",enable?"":"none"),d3.select("#panel_container").style("display",enable?"none":""),d3.select("#warning_data_info").style("display","none"),d3.select("#radio-area").style("display",enable?"none":""),d3.select("#radio_notice").style("display",enable?"none":"")},displayWarning:function(enable){void 0===enable&&(enable=!0),document.getElementById("warning_data_info").style.display=enable?"":"none",document.getElementById("warning_data_info").innerHTML='<h3><span id="txt8">'+Translation[Lang.language].txt8+"</span></h3>",document.getElementById("loading_data_info").style.display=enable?"none":""},loadData:function(error,data){return error?(console.log(error),!1):(graph.rawData=data,graph.normalizeData(),!0)},onDateRangeChange:function(){graph.displayWaitingChanges(),window.setTimeout(()=>{let dt0=new Date(utils.datePicker.getStartDate()._d),dt1=new Date(utils.datePicker.getEndDate()._d);if(dt1-dt0<0)alert(Translation[Lang.language].invalidRange);else{let isOk;graph.setDateRangeOnDataset(dt0,dt1)?(graph.build(),graph.displayCustomValues()):(alert(Translation[Lang.language].noData),graph.setDateRangeOnDataset(graph.dateFilterRange[0],graph.dateFilterRange[1]))}graph.displayWaitingChanges(!1)},100)},setDateRangeOnDataset(dt0,dt1){graph.dimensions.date.filterAll();let dt1_=new Date(dt1);return dt1_.setDate(dt1_.getDate()+1),graph.dimensions.date.filterRange([Date.parse(dt0),Date.parse(dt1_)]),0!=graph.dimensions.date.top(1).length&&(graph.dateFilterRange=[dt0,dt1],!0)},setDataDimension:function(d){graph.displayWaitingChanges(),window.setTimeout(()=>{graph.config.defaultDataDimension=d,graph.storeSelectedFilter(),graph.resetFilters(),graph.onDateRangeChange(),graph.updateToSelectedFilter(),graph.displayWaitingChanges(!1)},100)},storeSelectedFilter:function(){graph.selectedFilters={},graph.histTopByCounties.hasFilter()&&(graph.selectedFilters.byCounty=graph.histTopByCounties.filters()),graph.ringTotalizedByClass.hasFilter()&&(graph.selectedFilters.byClass=graph.ringTotalizedByClass.filters()),graph.lineDistributionByMonth.hasFilter()&&(graph.selectedFilters.byMonth=graph.lineDistributionByMonth.filters()),graph.ringTotalizedByState.hasFilter()&&(graph.selectedFilters.byState=graph.ringTotalizedByState.filters()),graph.histTopByUCs.hasFilter()&&(graph.selectedFilters.byUCs=graph.histTopByUCs.filters())},updateToSelectedFilter:function(){if(graph.selectedFilters.byCounty)for(;graph.selectedFilters.byCounty.length;)graph.histTopByCounties.filter(graph.selectedFilters.byCounty.pop());if(graph.selectedFilters.byClass)for(;graph.selectedFilters.byClass.length;)graph.ringTotalizedByClass.filter(graph.selectedFilters.byClass.pop());if(graph.selectedFilters.byState)for(;graph.selectedFilters.byState.length;)graph.ringTotalizedByState.filter(graph.selectedFilters.byState.pop());if(graph.selectedFilters.byUCs)for(;graph.selectedFilters.byUCs.length;)graph.histTopByUCs.filter(graph.selectedFilters.byUCs.pop());dc.redrawAll()},filterByClassGroup:function(ref){graph.displayWaitingChanges(),window.setTimeout(()=>{utils.highlightClassFilterButtons(ref),graph.ringTotalizedByClass.filterAll(),"deforestation"==ref?graph.deforestation.forEach(cl=>{graph.ringTotalizedByClass.filter(cl)}):"degradation"==ref&&graph.degradation.forEach(cl=>{graph.ringTotalizedByClass.filter(cl)}),dc.redrawAll(),graph.displayWaitingChanges(!1)},100)},filterByClass:function(){var filters=graph.ringTotalizedByClass.filters();if(0===filters.length)utils.highlightClassFilterButtons("custom");else{var eqDef=!0,eqDeg=!0;filters.forEach(f=>{graph.deforestation.includes(f)||(eqDef=!1),graph.degradation.includes(f)||(eqDeg=!1)}),eqDef=!!eqDef&&filters.length==graph.deforestation.length,eqDeg=!!eqDeg&&filters.length==graph.degradation.length,eqDef&&!eqDeg?utils.highlightClassFilterButtons("deforestation"):!eqDef&&eqDeg?utils.highlightClassFilterButtons("degradation"):utils.highlightClassFilterButtons("custom"),dc.redrawAll(),graph.displayCustomValues()}},resetFilters:function(){graph.rawData&&(graph.lineDistributionByMonth.filterAll(),graph.ringTotalizedByClass.filterAll(),graph.histTopByCounties.filterAll(),graph.ringTotalizedByState.filterAll(),graph.histTopByUCs.filterAll(),SearchEngine.applyCountyFilter(),SearchEngine.rebuildModalWindow())},resetLineDistributionByMonthFilter(){graph.lineDistributionByMonth&&graph.lineDistributionByMonth.hasFilter()&&graph.lineDistributionByMonth.filterAll(),graph.onDateRangeChange()},displayCustomValues:function(){let area=0,htmlBox="<div class='icon-left'><i class='fa fa-leaf fa-2x' aria-hidden='true'></i></div><span class='number-display'>";graph.dimensions.date.bottom(1).length&&new Date(graph.dimensions.date.bottom(1)[0].timestamp)<graph.dateFilterRange[0]&&graph.setDateRangeOnDataset(graph.dateFilterRange[0],graph.dateFilterRange[1]);let data=graph.areaByClass.all(),filters=graph.ringTotalizedByClass.filters();data.forEach(d=>{filters.length?filters.includes(d.key)&&(area+=d.value):area+=d.value}),area=localeBR.numberFormat(",1f")(area.toFixed(2)),graph.totalizedCustomArea.html(htmlBox+"<span>"+Translation[Lang.language].degrad_defor+"</span><div class='numberinf'>"+area+" kmÂ²</div></span>")},doResize:function(){graph.defaultHeight=utils.getDefaultHeight(),dc.renderAll()},normalizeData:function(){var numberFormat=d3.format(".2f"),json=[];this.rawData.forEach((function(rd){d=rd.properties;var o={uf:d.h,county:d.i,codIbge:d.b};o.uc=d.j?d.j:"null";var auxDate=new Date(d.g+"T04:00:00.000Z");o.timestamp=auxDate.getTime(),o.areaKm=1*numberFormat(d.e),o.areaUcKm=d.f?1*numberFormat(d.f):0,o.className=d.c,json.push(o)})),this.rawData=json,delete json,this.initCrossFilter()},initCrossFilter:function(){this.alertsCrossFilter=crossfilter(this.rawData),this.dimensions.area=this.alertsCrossFilter.dimension((function(d){return d.areaKm})),this.dimensions.county=this.alertsCrossFilter.dimension((function(d){return d.county+"/"+d.uf})),this.dimensions.codibge=this.alertsCrossFilter.dimension((function(d){return{codibge:d.codIbge,mun:d.county+"/"+d.uf}})),this.dimensions.class=this.alertsCrossFilter.dimension((function(d){return d.className})),this.dimensions.date=this.alertsCrossFilter.dimension((function(d){return d.timestamp})),this.dimensions.uf=this.alertsCrossFilter.dimension((function(d){return d.uf})),this.dimensions.uc=this.alertsCrossFilter.dimension((function(d){return d.uc+"/"+d.uf}));let endDate=new Date(graph.dimensions.date.top(1)[0].timestamp),startDate=new Date(endDate),minDate=new Date(graph.dimensions.date.bottom(1)[0].timestamp);minDate.setHours(minDate.getHours()-1),startDate.setDate(startDate.getDate()-365),startDate.setHours(startDate.getHours()-6),utils.datePicker.setInterval(startDate,endDate),utils.datePicker.setStartMaxDate(endDate),utils.datePicker.setStartMinDate(minDate),utils.datePicker.setEndMaxDate(endDate),utils.datePicker.setEndMinDate(minDate),this.setDateRangeOnDataset(startDate,endDate)},build:function(){var totalAlertsGroup=this.alertsCrossFilter.groupAll().reduce((function(p,v){return++p.n,p}),(function(p,v){return--p.n,p}),(function(){return{n:0}})),totalDeforestationAreaGroup=graph.dimensions.class.groupAll().reduce((function(p,v){return graph.deforestation.includes(v.className)&&(++p.n,p.tot+=v.areaKm),p}),(function(p,v){return graph.deforestation.includes(v.className)&&(--p.n,p.tot-=v.areaKm),p}),(function(){return{n:0,tot:0}})),totalDegradationAreaGroup=graph.dimensions.class.groupAll().reduce((function(p,v){return graph.degradation.includes(v.className)&&(++p.n,p.tot+=v.areaKm),p}),(function(p,v){return graph.degradation.includes(v.className)&&(--p.n,p.tot-=v.areaKm),p}),(function(){return{n:0,tot:0}})),groups=[];"area"==graph.config.defaultDataDimension?(groups.class=graph.dimensions.class.group().reduceSum((function(d){return+d.areaKm})),groups.county=graph.dimensions.county.group().reduceSum((function(d){return+d.areaKm})),groups.uf=graph.dimensions.uf.group().reduceSum((function(d){return+d.areaKm})),groups.date=graph.dimensions.date.group().reduceSum((function(d){return+d.areaKm})),groups.uc=graph.dimensions.uc.group().reduceSum((function(d){return"null"!=d.uc?+d.areaUcKm:0}))):(groups.class=graph.dimensions.class.group().reduceCount((function(d){return d.className})),groups.county=graph.dimensions.county.group().reduceCount((function(d){return d.county})),groups.uf=graph.dimensions.uf.group().reduceCount((function(d){return d.uf})),groups.date=graph.dimensions.date.group().reduceCount((function(d){return+d.timestamp})),groups.uc=graph.dimensions.uc.group().reduceSum((function(d){return"null"!=d.uc?1:0}))),this.areaByClass=graph.dimensions.class.group().reduceSum((function(d){return+d.areaKm}));var htmlBox="<div class='icon-left'><i class='fa fa-leaf fa-2x' aria-hidden='true'></i></div><span class='number-display'>";this.totalizedDeforestationArea.formatNumber(localeBR.numberFormat(",1f")),this.totalizedDeforestationArea.valueAccessor((function(d){return d.n?d.tot.toFixed(2):0})).html({one:htmlBox+"<span>"+Translation[Lang.language].deforestation+"</span><br/><div class='numberinf'>%number kmÂ²</div></span>",some:htmlBox+"<span>"+Translation[Lang.language].deforestation+"</span><br/><div class='numberinf'>%number kmÂ²</div></span>",none:htmlBox+"<span>"+Translation[Lang.language].deforestation+"</span><br/><div class='numberinf'>0 kmÂ²</div></span>"}).group(totalDeforestationAreaGroup),this.totalizedDegradationArea.formatNumber(localeBR.numberFormat(",1f")),this.totalizedDegradationArea.valueAccessor((function(d){return d.n?d.tot.toFixed(2):0})).html({one:htmlBox+"<span>"+Translation[Lang.language].degradation+"</span><br/><div class='numberinf'>%number kmÂ²</div></span>",some:htmlBox+"<span>"+Translation[Lang.language].degradation+"</span><br/><div class='numberinf'>%number kmÂ²</div></span>",none:htmlBox+"<span>"+Translation[Lang.language].degradation+"</span><br/><div class='numberinf'>0 kmÂ²</div></span>"}).group(totalDegradationAreaGroup),this.totalizedAlertsInfoBox.formatNumber(localeBR.numberFormat(",")),this.totalizedAlertsInfoBox.valueAccessor((function(d){return d.n?d.n:0})).html({one:htmlBox+"<span>"+Translation[Lang.language].num_alerts+"</span><br/><div class='numberinf'>%number</div></span>",some:htmlBox+"<span>"+Translation[Lang.language].num_alerts+"</span><br/><div class='numberinf'>%number</div></span>",none:htmlBox+"<span>"+Translation[Lang.language].num_alerts+"</span><br/><div class='numberinf'>0</div></span>"}).group(totalAlertsGroup),this.buildCharts(groups)},buildCharts:function(groups){var alertsMaxDate=graph.dimensions.date.top(1),alertsMinDate=graph.dimensions.date.bottom(1);utils.setTitle("timeline",Translation[Lang.language].timeline_header);var lastDate=new Date(alertsMaxDate[0].timestamp),firstDate=new Date(alertsMinDate[0].timestamp),dateFormat=localeBR.timeFormat("%d/%m/%Y"),x=d3.time.scale().domain([firstDate,lastDate]),yLabel="area"==graph.config.defaultDataDimension?utils.wildcardExchange("%Dim%")+" ("+utils.wildcardExchange("%unit%")+")":utils.wildcardExchange("%Unit%");this.lineDistributionByMonth.height(310).margins({top:10,right:45,bottom:55,left:45}).yAxisLabel(yLabel).dimension(graph.dimensions.date).group(groups.date).transitionDuration(300).elasticY(!0).x(x).brushOn(!1).centerBar(!0).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).colors(d3.scale.ordinal().range(["black"])),this.lineDistributionByMonth.on("filtered",(function(chart){graph.displayCustomValues()}));let customTicks=d3.time.months,numDays=utils.getNumberOfDaysForRangeDate(firstDate,lastDate);customTicks=numDays<45?d3.time.days:numDays<90?d3.time.weeks:d3.time.months,this.lineDistributionByMonth.on("preRender",(function(chart){chart.xUnits(d3.time.days).xAxis(d3.svg.axis().scale(x).orient("bottom").ticks(customTicks).tickFormat((function(d){var dt=d.toLocaleDateString(),adt=d.toLocaleDateString().split("/");return dt=chart.effectiveWidth()<graph.config.minWidth?Translation[Lang.language].months_names[d.getMonth()]+"/"+adt[2]:adt[0]+"/"+Translation[Lang.language].months_names[d.getMonth()]+"/"+adt[2]}))),chart.yAxis().tickFormat(d3.format(".2s"))})),this.lineDistributionByMonth.on("renderlet.a",(function(chart){chart.selectAll("g.x text").attr("transform","translate(-10,20) rotate(315)"),chart.hasFilter()?($("#txt9a").css("display",""),$("#highlight-time").css("display","none")):($("#txt9a").css("display","none"),$("#highlight-time").css("display",""),$("#highlight-time").html(" "+dateFormat(new Date(alertsMinDate[0].timestamp))+" - "+dateFormat(new Date(alertsMaxDate[0].timestamp))))})),this.lineDistributionByMonth.filterPrinter((function(f){let dt=new Date(f[0][0]),dt0=f[0][0].toDateString(),dt1=new Date(f[0][1]).toDateString();return Date.parse(new Date(dt1))>Date.parse(new Date(dt0))?(dt.setDate(dt.getDate()+1)," "+dateFormat(dt)+" - "+dateFormat(f[0][1])):" - "})),this.lineDistributionByMonth.title((function(d){return"empty"!=d.key?new Date(d.key).toLocaleDateString()+": "+utils.numberByUnit(d.value)+utils.wildcardExchange(" %unit%"):Translation[Lang.language].without})),utils.setTitle("counties",Translation[Lang.language].title_top_county),this.histTopByCounties.height(graph.defaultHeight).dimension(graph.dimensions.county).group(utils.removeLittlestValues(groups.county)).elasticX(!0).ordering((function(d){return d.county})).controlsUseVisibility(!0).ordinalColors([graph.barTop10Color]),this.histTopByCounties.on("filtered",(function(chart){graph.displayCustomValues(),SearchEngine.updateSelectedList()})),this.histTopByCounties.on("preRender",(function(chart){chart.height(graph.defaultHeight),chart.xAxis().ticks(chart.width()<graph.config.minWidth?5:6)})),this.histTopByCounties.on("preRedraw",(function(chart){chart.data().length>5?chart.fixedBarHeight(!1):chart.fixedBarHeight(parseInt(.7*chart.effectiveHeight()/10))})),this.histTopByCounties.on("pretransition",(function(chart){var texts=chart.selectAll("g.row text"),rankMun=function(){var allTop=groups.county.top(1/0),ar={};return allTop.forEach((function(k,i){ar['"'+k.key+'"']=i+1})),ar};texts[0].forEach((function(t){var p=rankMun()['"'+t.innerHTML.split(":")[0]+'"']?rankMun()['"'+t.innerHTML.split(":")[0]+'"']+"Âº - ":"";t.innerHTML=p+t.innerHTML}))})),this.histTopByCounties.xAxis().tickFormat((function(d){return d+utils.wildcardExchange(" %unit%")})),this.histTopByCounties.data((function(group){var fakeGroup=[];return fakeGroup.push({key:Translation[Lang.language].without,value:0}),group.all().length>0?group.top(10):fakeGroup})),this.histTopByCounties.title((function(d){return d.key+": "+utils.numberByUnit(d.value)+utils.wildcardExchange(" %unit%")})),this.histTopByCounties.label((function(d){return d.key+": "+utils.numberByUnit(d.value)+utils.wildcardExchange(" %unit%")})),utils.setTitle("state",Translation[Lang.language].title_tot_state),this.ringTotalizedByState.height(graph.defaultHeight).innerRadius(10).externalRadiusPadding(30).dimension(graph.dimensions.uf).group(utils.removeLittlestValues(groups.uf)).ordering(dc.pluck("key")).ordinalColors(graph.pallet).legend(dc.legend().x(20).y(10).itemHeight(13).gap(7).horizontal(0).legendWidth(50).itemWidth(35)),this.ringTotalizedByState.on("filtered",(function(chart){graph.displayCustomValues()})),this.ringTotalizedByState.on("preRender",(function(chart){chart.height(graph.defaultHeight),chart.legend().legendWidth(window.innerWidth/2)})),this.ringTotalizedByState.title((function(d){return"empty"!=d.key?d.key+": "+utils.numberByUnit(d.value)+utils.wildcardExchange(" %unit%"):Translation[Lang.language].without})),this.ringTotalizedByState.renderLabel(!0).minAngleForLabel(.5),this.ringTotalizedByState.label((function(d){var txtLabel="empty"!=d.key?utils.numberByUnit(d.value)+utils.wildcardExchange(" %unit%"):Translation[Lang.language].without,f;return graph.ringTotalizedByState.hasFilter()?graph.ringTotalizedByState.filters().indexOf(d.key)>=0?txtLabel:"":txtLabel})),graph.ctlFirstLoading||dc.override(this.ringTotalizedByState,"legendables",(function(){var legendables;return this._legendables().filter((function(l){return l.data>0}))})),utils.setTitle("class",Translation[Lang.language].title_tot_class),this.ringTotalizedByClass.height(graph.defaultHeight).innerRadius(10).externalRadiusPadding(30).dimension(graph.dimensions.class).group(utils.removeLittlestValues(groups.class)).ordinalColors(["#FFD700","#FF4500","#FF8C00","#FFA500","#6B8E23","#8B4513","#D2691E","#FF0000"]).legend(dc.legend().x(20).y(10).itemHeight(13).gap(7).horizontal(0).legendWidth(50).itemWidth(35).legendText((function(d){var t=utils.mappingClassNames(d.name);return"empty"!=d.name?t:Translation[Lang.language].without}))),this.ringTotalizedByClass.on("preRender",(function(chart){chart.height(graph.defaultHeight),chart.legend().legendWidth(window.innerWidth/2)})),this.ringTotalizedByClass.title((function(d){var v=utils.numberByUnit(d.value);v=localeBR.numberFormat(",1f")(v);var t=utils.mappingClassNames(d.key)+": "+v+" "+utils.wildcardExchange(" %unit%");return"CORTE_SELETIVO"===d.key&&(t=utils.mappingClassNames(d.key)+"*: "+v+" "+utils.wildcardExchange(" %unit%")+" ("+Translation[Lang.language].warning_class+")"),"empty"!=d.key?t:Translation[Lang.language].without})),this.ringTotalizedByClass.filterPrinter((function(f){var t=[];return f.forEach((function(cl){t.push(utils.mappingClassNames(cl))})),f.length?t:[Translation[Lang.language].without]})),this.ringTotalizedByClass.on("filtered",(function(chart){graph.displayCustomValues(),graph.filterByClass()})),this.ringTotalizedByClass.renderLabel(!0).minAngleForLabel(.5),this.ringTotalizedByClass.label((function(d){var txtLabel="empty"!=d.key?utils.numberByUnit(d.value)+utils.wildcardExchange(" %unit%"):Translation[Lang.language].without,f;return graph.ringTotalizedByClass.hasFilter()?graph.ringTotalizedByClass.filters().indexOf(d.key)>=0?txtLabel:"":txtLabel})),graph.ctlFirstLoading||dc.override(this.ringTotalizedByClass,"legendables",(function(){var legendables;return(null!=this._legendables?this._legendables():this.legendables()).filter((function(l){return l.data>0}))})),utils.setTitle("ucs",Translation[Lang.language].title_top_uc),this.histTopByUCs.height(graph.defaultHeight).dimension(graph.dimensions.uc).group(utils.removeLittlestValues(groups.uc)).elasticX(!0).ordering((function(d){return d.uc})).controlsUseVisibility(!0).ordinalColors([graph.barTop10Color]),this.histTopByUCs.on("preRender",(function(chart){chart.height(graph.defaultHeight),chart.xAxis().ticks(chart.width()<graph.config.minWidth?4:7)})),this.histTopByUCs.on("preRedraw",(function(chart){chart.data().length>5?chart.fixedBarHeight(!1):chart.fixedBarHeight(parseInt(.7*chart.effectiveHeight()/10))})),this.histTopByUCs.on("filtered",(function(chart){graph.displayCustomValues()})),this.histTopByUCs.on("pretransition",(function(chart){var texts=chart.selectAll("g.row text"),rankMun=function(){var allTop=groups.uc.top(1/0),ar={};return allTop.forEach((function(k,i){ar['"'+k.key+'"']=i+1})),ar};texts[0].forEach((function(t){var p=rankMun()['"'+t.innerHTML.split(":")[0]+'"']?rankMun()['"'+t.innerHTML.split(":")[0]+'"']+"Âº - ":"";t.innerHTML=p+t.innerHTML}))})),this.histTopByUCs.xAxis().tickFormat((function(d){return d+utils.wildcardExchange(" %unit%")})),this.histTopByUCs.data((function(group){var fakeGroup=[];return fakeGroup.push({key:Translation[Lang.language].without,value:0}),group.all().length>0?group.top(10):fakeGroup})),this.histTopByUCs.title((function(d){return d.key+": "+utils.numberByUnit(d.value)+utils.wildcardExchange(" %unit%")})),this.histTopByUCs.label((function(d){return d.key+": "+utils.numberByUnit(d.value)+utils.wildcardExchange(" %unit%")}));let downloadCsvFnc=function(inpudata){utils.download=function(data){var blob=new Blob([d3.csv.format(data)],{type:"text/csv;charset=utf-8"});saveAs(blob,downloadCtrl.getProject()+"-daily-"+downloadCtrl.getDownloadTime()+".csv")},window.setTimeout((function(){var data=[];inpudata.forEach((function(d){var o={},dt=new Date(d.timestamp);o.viewDate=dt.toLocaleDateString(),o.areaMunKm=d.areaKm,o.areaUcKm=d.areaUcKm,o.uc="null"!=d.uc?d.uc:"",o.uf=d.uf,o.municipio=d.county,o.geocod=d.codIbge,o.className=d.className,d.areaKm&&data.push(o)})),utils.download(data)}),200)};d3.select("#download-csv-daily-all").on("click",(function(){let inpudata=graph.rawData;downloadCsvFnc(inpudata)})),d3.select("#download-csv-daily").on("click",(function(){let inpudata=graph.dimensions.class.top(1/0);downloadCsvFnc(inpudata)})),d3.select("#download-shp").on("click",(function(){downloadCtrl.startDownload()})),d3.select("#prepare_print").on("click",(function(){graph.preparePrint()})),graph.doResize(),window.onresize=utils.onResize,this.ctlFirstLoading=!0},preparePrint:function(){d3.select("#print_information").style("display","block"),d3.select("#print_page").on("click",(function(){d3.select("#print_information").style("display","none"),window.print()}))},configurePrintKeys:function(){Mousetrap.bind(["command+p","ctrl+p"],(function(){return console.log("command p or control p is disabled"),!1}))},restart(){graph.startLoadData()}};window.onload=function(){graph.configurePrintKeys(),utils.datePicker.initComponent(),Lang.init(),graph.startLoadData(),"undefined"!=typeof Authentication&&(Authentication.serverURL="/oauth-api/",Authentication.init(Lang.language,(function(){graph.resetFilters(),graph.restart()})))};